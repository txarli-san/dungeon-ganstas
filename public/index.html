<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Text Adventure Game</title>
        <link rel="stylesheet" href="https://unpkg.com/xterm/css/xterm.css" />
        <script src="https://unpkg.com/xterm/lib/xterm.js"></script>
    </head>
    <body>
        <div id="terminal"></div>
        <script>
            const term = new Terminal();
            term.open(document.getElementById("terminal"));

            const socket = new WebSocket("ws://localhost:8080");

            socket.onmessage = (event) => {
                term.writeln(event.data);
            };

            term.onKey(({ key, domEvent }) => {
                if (domEvent.keyCode === 13) {
                    // Enter key
                    socket.send(
                        term.buffer.active
                            .getLine(term.buffer.active.length - 1)
                            .translateToString(),
                    );
                    term.write("\r\n");
                } else {
                    socket.send(key);
                    term.write(key);
                }
            });
        </script>
    </body>
</html>
